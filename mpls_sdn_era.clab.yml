---
# Based on https://github.com/h4ndzdatm0ld/spauto_devnet/
name: "sdnera"

mgmt:
  network: "mpls_sdn_era"                     # management network name
  ipv4_subnet: "172.100.101.0/24"       # ipv4 range

topology:
  defaults:
  kinds:
    crpd:  # root/clab@123
      license: crpd_90d_license_20220817.txt
      image: hub.juniper.net/routing/crpd:19.4R1.10
    linux:
      image: wbitt/network-multitool:latest

  nodes:
    pe1:
      kind: "crpd"
      mgmt_ipv4: 172.100.101.11
    pe2:
      kind: "crpd"
      mgmt_ipv4: 172.100.101.22
    pe3:
      kind: "crpd"
      mgmt_ipv4: 172.100.101.33
    pe4:
      kind: "crpd"
      mgmt_ipv4: 172.100.101.44
    p1:
      kind: "crpd"
      mgmt_ipv4: 172.100.101.101
    p2:
      kind: crpd
      mgmt_ipv4: 172.100.101.102
    rr1:
      kind: "crpd"
      mgmt_ipv4: 172.100.101.201
    rr2:
      kind: "crpd"
      mgmt_ipv4: 172.100.101.202
    ce1:
      kind: "crpd"
      mgmt_ipv4: 172.100.101.151
    ce2:
      kind: "crpd"
      mgmt_ipv4: 172.100.101.152
    br3:
      kind: "crpd"
      mgmt_ipv4: 172.100.101.153
    br4:
      kind: "crpd"
      mgmt_ipv4: 172.100.101.154
    h1:
      kind: linux
      mgmt_ipv4: 172.100.101.161
      exec:
        - ip addr add 10.1.12.10/24 dev eth1
    h3:
      kind: linux
      mgmt_ipv4: 172.100.101.161
      exec:
        - ip addr add 10.2.34.30/24 dev eth1
    br-pe-bridge: # Needs to be manually created!
      kind: bridge
    h1-ce-bridge: # Needs to be manually created!
      kind: bridge
    h3-br-bridge: # Needs to be manually created!
      kind: bridge

  links:
    # PE1 <> P1
    - endpoints: ["pe1:eth5", "p1:eth2"]
    # PE1 <> PE2
    - endpoints: ["pe1:eth4", "pe2:eth3"]
    # PE2 <> P2
    - endpoints: ["pe2:eth4", "p2:eth1"]
    # PE3 <> P1
    - endpoints: ["pe3:eth2", "p1:eth7"]
    # PE3 <> P4
    - endpoints: ["pe3:eth3", "pe4:eth2"]
    # PE4 <> P2
    - endpoints: ["pe4:eth1", "p2:eth6"]

    # P1 TO P2 CORE LINKS
    # P1 <> P2
    - endpoints: ["p1:eth5", "p2:eth4"]
    - endpoints: ["p1:eth4", "p2:eth3"]

    # Route Reflectors R1
    # RR1 <> P1
    - endpoints: ["rr1:eth2", "p1:eth3"]

    # RR1 <> P2
    - endpoints: ["rr1:eth4", "p2:eth2"]
    # Route Reflectors R2
    # RR2 <> P1
    - endpoints: ["rr2:eth1", "p1:eth6"]
    # RR2 <> P2
    - endpoints: ["rr2:eth3", "p2:eth5"]

    # CORE LINK BETWEEN RRs
    # RR1 <> RR2
    - endpoints: ["rr1:eth3", "rr2:eth2"] 
    
    # CE TO PE
    - endpoints: ["ce1:eth3", "pe1:eth2"]
    - endpoints: ["ce1:eth4", "pe2:eth2"]
    - endpoints: ["ce2:eth3", "pe1:eth3"]
    - endpoints: ["ce2:eth4", "pe1:eth3"]

    # BR TO PE
    - endpoints: ["br3:eth2", "br-pe-bridge:eth1"]
    - endpoints: ["br4:eth2", "br-pe-bridge:eth2"]
    - endpoints: ["pe3:eth4", "br-pe-bridge:eth3"]
    - endpoints: ["pe4:eth2", "br-pe-bridge:eth4"]

    # H1
    - endpoints: ["h1:eth1", "h1-ce-bridge:eth1"]
    - endpoints: ["ce1:eth2", "h1-ce-bridge:eth2"]
    - endpoints: ["ce2:eth2", "h1-ce-bridge:eth3"]

    # H3
    - endpoints: ["h3:eth1", "h3-br-bridge:eth1"]
    - endpoints: ["br3:eth3", "h3-br-bridge:eth2"]
    - endpoints: ["br3:eth3", "h3-br-bridge:eth3"]

